<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>재고 현황 관리</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Google Sheets API URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzvfxGT1BP6guGLZeUduJqx1xVLt6dUtyFFNR2t78uKwooHZ2fz90P3XaJqclzNX9s/exec';

        // 품목 이름 매핑
        const ITEM_NAMES = [
            '0후지', '3후지', 'S후지', '등심', '지방', '사골', '단족',
            '삼겹(등갈비X)', '삼겹(등갈비O)', '롤삼겹', '갈비(3대)', '갈비(4대)',
            '목살', 'B목살', 'T등뼈', 'T목뼈', '싹뼈', '안심', '잡육', '갈매기',
            '한우스지', '한우사골', '한우잡뼈', '목전지', '대패', '깐양'
        ];

        // Package 아이콘 컴포넌트
        const Package = ({ size = 24, className = "" }) => (
            <svg 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round"
                className={className}
            >
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
        );

        function InventoryManager() {
            const [inventory, setInventory] = useState([]);
            const [selectedItem, setSelectedItem] = useState(null);
            const [loading, setLoading] = useState(true);
            const [syncing, setSyncing] = useState(false);

            // 초기 데이터 로드
            useEffect(() => {
                loadInventory();
            }, []);

            // Google Sheets에서 데이터 가져오기
            const loadInventory = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(SCRIPT_URL);
                    const data = await response.json();
                    
                    // 품목 이름 추가
                    const inventoryWithNames = data.map((item, index) => ({
                        ...item,
                        name: ITEM_NAMES[index] || `품목${item.id}`
                    }));
                    
                    setInventory(inventoryWithNames);
                } catch (error) {
                    console.error('데이터 로드 실패:', error);
                    alert('데이터를 불러오는데 실패했습니다. 페이지를 새로고침 해주세요.');
                } finally {
                    setLoading(false);
                }
            };

            // Google Sheets에 데이터 저장
            const saveToSheet = async (id, boxStock, packStock) => {
                try {
                    setSyncing(true);
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            id: id,
                            boxStock: boxStock,
                            packStock: packStock
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('저장 실패');
                    }
                } catch (error) {
                    console.error('저장 실패:', error);
                    alert('저장에 실패했습니다. 다시 시도해주세요.');
                } finally {
                    setSyncing(false);
                }
            };

            const updateStock = async (id, unit, change) => {
                // 로컬 상태 업데이트
                const updatedInventory = inventory.map(item => {
                    if (item.id === id) {
                        if (unit === 'box') {
                            const newStock = Math.max(0, item.boxStock + change);
                            // Google Sheets에 저장
                            saveToSheet(id, newStock, item.packStock);
                            return { ...item, boxStock: newStock };
                        } else {
                            const newStock = Math.max(0, item.packStock + change);
                            // Google Sheets에 저장
                            saveToSheet(id, item.boxStock, newStock);
                            return { ...item, packStock: newStock };
                        }
                    }
                    return item;
                });
                
                setInventory(updatedInventory);
            };

            const handleItemClick = (id) => {
                setSelectedItem(selectedItem === id ? null : id);
            };

            if (loading) {
                return (
                    <div className="w-full min-h-screen bg-gray-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-2xl font-bold text-black mb-2">로딩중...</div>
                            <div className="text-gray-600">데이터를 불러오는 중입니다</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="w-full min-h-screen bg-gray-100 overflow-auto">
                    <div className="min-h-screen flex flex-col max-w-7xl mx-auto">
                        <div className="bg-black shadow-md p-3 sm:p-4 flex-shrink-0 sticky top-0 z-10">
                            <div className="flex items-center justify-center gap-2 sm:gap-3">
                                <Package size={24} className="text-white sm:hidden" />
                                <Package size={28} className="text-white hidden sm:block" />
                                <h1 className="text-2xl sm:text-3xl font-bold text-white">재고 현황</h1>
                                {syncing && (
                                    <div className="ml-2 text-xs sm:text-sm text-yellow-300">동기화 중...</div>
                                )}
                            </div>
                        </div>

                        <div className="flex-1 p-2 sm:p-4">
                            <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3">
                                {inventory.map((item) => (
                                    <div key={item.id}>
                                        <div
                                            onClick={() => handleItemClick(item.id)}
                                            className={`border-2 rounded-xl p-2 sm:p-3 cursor-pointer transition-all ${
                                                selectedItem === item.id
                                                    ? 'border-black bg-gray-200 shadow-lg'
                                                    : 'border-gray-400 bg-white hover:border-gray-600 hover:shadow-md'
                                            }`}
                                        >
                                            <h3 className="text-sm sm:text-base font-bold text-black mb-1 sm:mb-2 text-center">
                                                {item.name}
                                            </h3>
                                            <div className="space-y-1">
                                                <div className="flex items-center justify-center gap-1 sm:gap-2">
                                                    <span className="text-xl sm:text-2xl font-bold text-red-600">
                                                        {item.boxStock}
                                                    </span>
                                                    <span className="text-xs sm:text-sm text-gray-600 font-medium">
                                                        박스
                                                    </span>
                                                </div>
                                                <div className="flex items-center justify-center gap-1 sm:gap-2">
                                                    <span className="text-xl sm:text-2xl font-bold text-blue-600">
                                                        {item.packStock}
                                                    </span>
                                                    <span className="text-xs sm:text-sm text-gray-600 font-medium">
                                                        팩
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {selectedItem === item.id && (
                                            <div className="mt-2 bg-white border-2 border-black rounded-xl p-2 sm:p-3 shadow-lg">
                                                {/* 박스 조절 */}
                                                <div className="mb-2 sm:mb-3">
                                                    <div className="text-xs sm:text-sm font-bold text-red-600 mb-1 text-center">박스 (B)</div>
                                                    <div className="grid grid-cols-4 gap-1 sm:gap-2">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'box', -5);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-gray-600 text-white rounded-lg active:bg-gray-800 transition-colors font-bold"
                                                        >
                                                            -5
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'box', -1);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-gray-500 text-white rounded-lg active:bg-gray-700 transition-colors font-bold"
                                                        >
                                                            -1
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'box', 1);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-red-500 text-white rounded-lg active:bg-red-700 transition-colors font-bold"
                                                        >
                                                            +1
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'box', 5);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-red-600 text-white rounded-lg active:bg-red-800 transition-colors font-bold"
                                                        >
                                                            +5
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* 팩 조절 */}
                                                <div>
                                                    <div className="text-xs sm:text-sm font-bold text-blue-600 mb-1 text-center">팩 (P)</div>
                                                    <div className="grid grid-cols-4 gap-1 sm:gap-2">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'pack', -5);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-gray-600 text-white rounded-lg active:bg-gray-800 transition-colors font-bold"
                                                        >
                                                            -5
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'pack', -1);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-gray-500 text-white rounded-lg active:bg-gray-700 transition-colors font-bold"
                                                        >
                                                            -1
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'pack', 1);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-blue-500 text-white rounded-lg active:bg-blue-700 transition-colors font-bold"
                                                        >
                                                            +1
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                updateStock(item.id, 'pack', 5);
                                                            }}
                                                            className="py-2 sm:py-2 text-sm sm:text-base bg-blue-600 text-white rounded-lg active:bg-blue-800 transition-colors font-bold"
                                                        >
                                                            +5
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InventoryManager />);
    </script>
</body>
</html>
